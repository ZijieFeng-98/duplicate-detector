â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ”§ SURGICAL PATCH: Micro-Tiles ONLY (NO GRID DETECTION)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Apply these 3 edits to: ai_pdf_panel_duplicate_check_AUTO.py

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  EDIT 1: Add Tile-First Import (Line ~30, after tile_detection import)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FIND THIS BLOCK:
```
# Tile detection module (optional)
try:
    from tile_detection import (
        TileConfig,
        run_tile_detection_pipeline,
        apply_tile_evidence_to_dataframe
    )
    TILE_MODULE_AVAILABLE = True
except ImportError:
    TILE_MODULE_AVAILABLE = False
    print("âš ï¸  Tile detection module not found, using panel-level only")
```

ADD IMMEDIATELY AFTER:
```python
# Tile-first pipeline (micro-tiles ONLY, NO GRID)
try:
    from tile_first_pipeline import TileFirstConfig, run_tile_first_pipeline
    TILE_FIRST_AVAILABLE = True
except ImportError:
    TILE_FIRST_AVAILABLE = False
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  EDIT 2: Add CLI Arguments (Line ~4820, in parse_cli_args function)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FIND THIS BLOCK:
```
    # Tile-based detection (AUTO-ENABLED for confocal)
    parser.add_argument("--enable-tile-mode", dest="enable_tile_mode", action="store_true", help="Force enable sub-panel tile verification")
    parser.add_argument("--disable-tile-mode", dest="disable_tile_mode", action="store_true", help="Disable tile mode (even if confocal detected)")
    parser.set_defaults(enable_tile_mode=False, disable_tile_mode=False)
```

ADD IMMEDIATELY AFTER:
```python
    # Tile-first mode (micro-tiles ONLY, bypasses panel pipeline)
    parser.add_argument("--tile-first", action="store_true", default=False, 
                       help="Use tile-first pipeline (micro-tiles ONLY, NO grid detection)")
    parser.add_argument("--tile-size", type=int, default=384, 
                       help="Tile size for micro-tiling (default: 384)")
    parser.add_argument("--tile-stride", type=float, default=0.65, 
                       help="Tile stride ratio for overlap (default: 0.65 = 35%% overlap)")
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  EDIT 3: Add Fast-Path in main() (BEFORE Stage 1 CLIP)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FIND THIS LINE (around line 4500):
```
    # â•â•â• STAGE 1: CLIP SEMANTIC FILTERING â•â•â•
    print(f"\n[Stage 1] CLIP semantic filtering (â‰¥{TIER_A_CLIP_THRESHOLD})...")
```

ADD THIS ENTIRE BLOCK **IMMEDIATELY BEFORE** THAT LINE:

```python
    # â•â•â• TILE-FIRST FAST-PATH (BYPASSES PANEL PIPELINE) â•â•â•
    if TILE_FIRST_AVAILABLE and getattr(args, "tile_first", False):
        print(f"\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
        print(f"â•‘  ğŸ”¬ TILE-FIRST MODE: Micro-Tiles ONLY (NO GRID DETECTION)       â•‘")
        print(f"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
        
        # Configure tile-first
        tfc = TileFirstConfig()
        tfc.CONFOCAL_MIN_GRID = 999        # â† Force NO grid detection
        tfc.WB_MIN_LANES = 999             # â† Force NO lane detection
        tfc.MICRO_TILE_SIZE = getattr(args, "tile_size", 384)
        tfc.MICRO_TILE_STRIDE = getattr(args, "tile_stride", 0.65)
        tfc.TILE_CLIP_MIN = TIER_A_CLIP_THRESHOLD
        
        # Load CLIP model
        from open_clip_wrapper import load_clip
        clip_model, preprocess = load_clip(device=DEVICE)
        
        # Run tile-first pipeline
        df_merged = run_tile_first_pipeline(
            panel_paths=[str(p) for p in panels],
            clip_model=clip_model,
            preprocess=preprocess,
            device=DEVICE,
            config=tfc
        )
        
        # Save results
        final_path = OUT_DIR / "final_merged_report.tsv"
        df_merged.to_csv(final_path, sep="\t", index=False)
        
        print(f"\n  âœ“ Final report: {final_path}")
        print(f"     Total pairs: {len(df_merged)}")
        if len(df_merged) > 0:
            print(f"     Tier A: {len(df_merged[df_merged['Tier'] == 'A'])}")
            print(f"     Tier B: {len(df_merged[df_merged['Tier'] == 'B'])}")
        
        print(f"\n{'='*70}")
        print(f"  âœ… TILE-FIRST PIPELINE COMPLETE")
        print(f"{'='*70}")
        print(f"  â±ï¸  Runtime: {time.time() - START_TIME:.1f}s")
        print(f"{'='*70}")
        
        return  # â† CRITICAL: Exit here, skip panel pipeline
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  VERIFICATION AFTER APPLYING PATCHES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Import check:
   $ python3 -c "from tile_first_pipeline import TileFirstConfig; print('OK')"

2. Syntax check:
   $ python3 -m py_compile ai_pdf_panel_duplicate_check_AUTO.py

3. Help check:
   $ python3 ai_pdf_panel_duplicate_check_AUTO.py --help | grep -A 2 "tile-first"
   
   Should show:
   --tile-first          Use tile-first pipeline (micro-tiles ONLY, NO grid detection)
   --tile-size           Tile size for micro-tiling (default: 384)
   --tile-stride         Tile stride ratio for overlap (default: 0.65 = 35% overlap)

4. Test run:
   $ python3 ai_pdf_panel_duplicate_check_AUTO.py \
       --pdf "test.pdf" \
       --output "/tmp/test" \
       --tile-first \
       --no-auto-open
   
   Should see:
   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  ğŸ”¬ TILE-FIRST MODE: Micro-Tiles ONLY (NO GRID DETECTION)       â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  KEY POINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Edit 3 MUST have `return` at the end to exit early
âœ“ Edit 3 goes BEFORE "[Stage 1] CLIP" line
âœ“ Config forces NO grid: CONFOCAL_MIN_GRID = 999, WB_MIN_LANES = 999
âœ“ All images become 384Ã—384 micro-tiles (NO grid, NO lane detection)
âœ“ Extraction_Method column will show "micro" for ALL rows

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

