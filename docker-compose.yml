version: '3.8'

services:
  duplicate-detector:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./input:/input
      - ./output:/output
      - ./config.yaml:/app/config.yaml:ro
    environment:
      - PYTHONUNBUFFERED=1
    command: --pdf /input/paper.pdf --output /output --config /app/config.yaml

  streamlit:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8501:8501"
    volumes:
      - .:/app
    environment:
      - PYTHONUNBUFFERED=1
    command: streamlit run streamlit_app.py --server.port=8501 --server.address=0.0.0.0

  # GPU-enabled service (uncomment if you have NVIDIA GPU)
  # duplicate-detector-gpu:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.gpu
  #   volumes:
  #     - ./input:/input
  #     - ./output:/output
  #   environment:
  #     - CUDA_VISIBLE_DEVICES=0
  #   deploy:
  #     resources:
  #       reservations:
  #         devices:
  #           - driver: nvidia
  #             count: 1
  #             capabilities: [gpu]

